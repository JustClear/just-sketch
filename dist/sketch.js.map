{"version":3,"file":"sketch.js","sources":["../src/common.js","../src/index.js"],"sourcesContent":["export function preload(imageURLs, done) {\n    const images = [];\n    let count = 0;\n    imageURLs = (typeof imageURLs != 'object') ? [imageURLs] : imageURLs;\n\n    imageURLs.length === 0 && done(images);\n\n    imageURLs.map(imageURL => {\n        const image = new Image();\n        image.src = imageURL;\n        image.crossOrigin = '*';\n        image.addEventListener('load', imageOnLoad);\n        image.addEventListener('error', imageOnLoad);\n        images.push(image);\n    });\n\n    function imageOnLoad() {\n        count ++;\n        if (count == imageURLs.length) done(images);\n    }\n}\n","import { preload } from './common';\n\nexport default function sketch() {\n    if (!(this instanceof sketch)) return new sketch(...arguments);\n    this.init(...arguments);\n}\n\nsketch.prototype.init = function () {\n    const [width, height] = arguments;\n\n    if (typeof width === 'number' && typeof height === 'number') {\n        this.width = width;\n        this.height = height;\n    }\n\n    this.symbols = [];\n    this.catch = function() {};\n};\n\nsketch.prototype.initCanvas = function (width, height) {\n    this.canvas = document.createElement('canvas');\n    this.canvas.width = width;\n    this.canvas.height = height;\n    this.ctx = this.canvas.getContext('2d');\n    return this.ctx;\n};\n\nsketch.prototype.import = function (image) {\n    if (typeof image === 'string') {\n        this.background = image;\n    } else {\n        console.log('.import(): import unknown type.');\n    }\n    return this;\n};\n\nsketch.prototype.join = function (image = '', options = {}) {\n    if (typeof image === 'string') {\n        options.image = image;\n        this.symbols.push(options);\n    } else {\n        console.log('.join(): join unknown type.');\n    }\n    return this;\n};\n\nsketch.prototype.rect = function (options = {}) {\n    options.type = 'rect';\n    this.symbols.push(options);\n    return this;\n};\n\nsketch.prototype.export = function (output = function () {}) {\n    preload(this.background, ([background]) => {\n        this.naturalRatio = background.naturalHeight / background.naturalWidth;\n        this.width = this.width || background.naturalWidth;\n        this.height = this.height || background.naturalHeight;\n        this.initCanvas(this.width, this.height);\n        this.ctx.drawImage(background, 0, 0, this.width, this.width * this.naturalRatio);\n\n        preload(this.symbols.map(symbol => symbol.image || ''), (images) => {\n            images.map((image, index) => {\n                const option = this.symbols[index];\n                const { top = 0, right = 0, bottom = 0, left = 0 } = option;\n                let width, height, offsetX, offsetY;\n                option.ratio = image.naturalHeight / image.naturalWidth;\n                if (option.width && option.height == undefined) {\n                    width = option.width;\n                    height = width * option.ratio;\n                } else if (option.height && option.width == undefined) {\n                    height = option.height;\n                    width = height / option.ratio;\n                } else if (option.width && option.height) {\n                    width = option.width;\n                    height = option.height;\n                } else if (option.height == undefined && option.width == undefined) {\n                    width = image.naturalWidth;\n                    height = image.naturalHeight;\n                } else {\n                    console.log('joined symbol size error');\n                }\n                if (left !== 0 && top !== 0) {\n                    offsetX = left;\n                    offsetY = top;\n                } else if (left !== 0 && bottom !== 0) {\n                    offsetX = left;\n                    offsetY = this.height - (height + bottom);\n                } else if (right !== 0 && top !== 0) {\n                    offsetX = this.width - (width + right);\n                    offsetY = top;\n                } else if (right !== 0 && bottom !== 0) {\n                    offsetX = this.width - (width + right);\n                    offsetY = this.height - (height + bottom);\n                } else {\n                    console.log('symbol position error: only adjacent sides position are accepted');\n                }\n                width = width || 0;\n                height = height || 0;\n                offsetX = offsetX || 0;\n                offsetY = offsetY || 0;\n                if (option.type == 'rect') {\n                    if (option.backgroundColor) {\n                        this.ctx.fillStyle = option.backgroundColor || '#000';\n                        this.ctx.fillRect(offsetX + option.borderWidth, offsetY + option.borderWidth, width, height);\n                    }\n                    if (option.borderWidth) {\n                        this.ctx.beginPath();\n                        this.ctx.lineWidth = option.borderWidth;\n                        this.ctx.strokeStyle = option.borderColor || '#000';\n                        this.ctx.rect(offsetX + option.borderWidth, offsetY + option.borderWidth, width, height);\n                        this.ctx.stroke();\n                    }\n                } else {\n                    this.ctx.drawImage(image, 0, 0, image.naturalWidth, image.naturalHeight, offsetX , offsetY , width, height);\n                }\n            });\n            try {\n                output(this.canvas.toDataURL(`image/${sketch.imageType || 'jpeg'}`), this.ctx, this.canvas);\n            } catch (error) {\n                setTimeout(() => this.catch(error), 0);\n            }\n        });\n    });\n    return this;\n};\n"],"names":["const","let","this"],"mappings":"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"}