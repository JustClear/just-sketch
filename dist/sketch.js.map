{"version":3,"file":"sketch.js","sources":["../src/common.js","../src/index.js"],"sourcesContent":["export function preload(imageURLs, done) {\n    const images = [];\n    let count = 0;\n    imageURLs = (typeof imageURLs != 'object') ? [imageURLs] : imageURLs;\n\n    imageURLs.length === 0 && done(images);\n\n    imageURLs.map(imageURL => {\n        const image = new Image();\n        image.src = imageURL;\n        image.crossOrigin = '*';\n        image.addEventListener('load', imageOnLoad);\n        image.addEventListener('error', imageOnLoad);\n        images.push(image);\n    });\n\n    function imageOnLoad() {\n        count ++;\n        if (count == imageURLs.length) done(images);\n    }\n}\n","import { preload } from './common';\n\nexport default function sketch() {\n    if (!(this instanceof sketch)) return new sketch(...arguments);\n    this.init(...arguments);\n}\n\nsketch.prototype.init = function () {\n    const [width, height] = arguments;\n\n    if (typeof width === 'number' && typeof height === 'number') {\n        this.width = width;\n        this.height = height;\n    }\n\n    this.symbols = [];\n    this.catch = function() {};\n};\n\nsketch.prototype.initCanvas = function (width, height) {\n    this.canvas = document.createElement('canvas');\n    this.canvas.width = width;\n    this.canvas.height = height;\n    this.ctx = this.canvas.getContext('2d');\n    return this.ctx;\n};\n\nsketch.prototype.import = function (image) {\n    if (typeof image === 'string') {\n        this.background = image;\n    } else {\n        console.log('.import(): import unknown type.');\n    }\n    return this;\n};\n\nsketch.prototype.join = function (image = '', options = {}) {\n    if (typeof image === 'string') {\n        options.image = image;\n        this.symbols.push(options);\n    } else {\n        console.log('.join(): join unknown type.');\n    }\n    return this;\n};\n\nsketch.prototype.rect = function (options = {}) {\n    options.type = 'rect';\n    this.symbols.push(options);\n    return this;\n};\n\nsketch.prototype.export = function (output = function () {}) {\n    preload(this.background, ([background]) => {\n        this.width = this.width || background.naturalWidth;\n        this.height = this.height || background.naturalHeight;\n        this.initCanvas(this.width, this.height);\n        this.ctx.drawImage(background, 0, 0, this.width, this.height);\n\n        preload(this.symbols.map(symbol => symbol.image || ''), (images) => {\n            images.map((image, index) => {\n                const option = this.symbols[index];\n                const { top = 0, right = 0, bottom = 0, left = 0 } = option;\n                let width, height, offsetX, offsetY;\n                option.ratio = image.naturalHeight / image.naturalWidth;\n                if (option.width && option.height == undefined) {\n                    width = option.width;\n                    height = width * option.ratio;\n                } else if (option.height && option.width == undefined) {\n                    height = option.height;\n                    width = height / option.ratio;\n                } else if (option.width && option.height) {\n                    width = option.width;\n                    height = option.height;\n                } else if (option.height == undefined && option.width == undefined) {\n                    width = image.naturalWidth;\n                    height = image.naturalHeight;\n                } else {\n                    console.log('joined symbol size error');\n                }\n                if (left !== 0 && top !== 0) {\n                    offsetX = left;\n                    offsetY = top;\n                } else if (left !== 0 && bottom !== 0) {\n                    offsetX = left;\n                    offsetY = this.height - (height + bottom);\n                } else if (right !== 0 && top !== 0) {\n                    offsetX = this.width - (width + right);\n                    offsetY = top;\n                } else if (right !== 0 && bottom !== 0) {\n                    offsetX = this.width - (width + right);\n                    offsetY = this.height - (height + bottom);\n                } else {\n                    console.log('symbol position error: only adjacent sides position are accepted');\n                }\n                width = width || 0;\n                height = height || 0;\n                offsetX = offsetX || 0;\n                offsetY = offsetY || 0;\n                if (option.type == 'rect') {\n                    if (option.backgroundColor) {\n                        this.ctx.fillStyle = option.backgroundColor || '#000';\n                        this.ctx.fillRect(offsetX + option.borderWidth, offsetY + option.borderWidth, width, height);\n                    }\n                    if (option.borderWidth) {\n                        this.ctx.beginPath();\n                        this.ctx.lineWidth = option.borderWidth;\n                        this.ctx.strokeStyle = option.borderColor || '#000';\n                        this.ctx.rect(offsetX + option.borderWidth, offsetY + option.borderWidth, width, height);\n                        this.ctx.stroke();\n                    }\n                } else {\n                    this.ctx.drawImage(image, 0, 0, image.naturalWidth, image.naturalHeight, offsetX , offsetY , width, height);\n                }\n            });\n            try {\n                output(this.canvas.toDataURL(`image/${sketch.imageType || 'jpeg'}`), this.ctx, this.canvas);\n            } catch (error) {\n                setTimeout(() => this.catch(error), 0);\n            }\n        });\n    });\n    return this;\n};\n"],"names":["preload","imageURLs","done","images","count","length","map","image","Image","src","imageURL","crossOrigin","addEventListener","imageOnLoad","push","sketch","arguments","init","prototype","width","height","symbols","catch","initCanvas","canvas","document","createElement","ctx","getContext","import","background","log","join","options","rect","type","export","output","naturalWidth","naturalHeight","drawImage","symbol","index","option","top","right","bottom","left","offsetX","offsetY","ratio","undefined","backgroundColor","fillStyle","fillRect","borderWidth","beginPath","lineWidth","strokeStyle","borderColor","stroke","toDataURL","imageType","error"],"mappings":"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"}