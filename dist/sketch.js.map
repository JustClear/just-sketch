{"version":3,"file":"sketch.js","sources":["../src/common.js","../src/index.js"],"sourcesContent":["export function preload(imageURLs) {\n    const images = [];\n    let count = 0,\n        doneAction = function () {},\n        progressAction = function () {};\n\n    imageURLs = (typeof imageURLs != 'object') ? [imageURLs] : imageURLs;\n\n    imageURLs.length === 0 && doneAction(images);\n\n    imageURLs.map((image, i) => {\n        images[i] = new Image();\n        images[i].src = image;\n        images[i].onload = imageLoad;\n        images[i].onerror = imageLoad;\n    });\n\n    function imageLoad() {\n        progressAction((count + 1) * 100 / images.length, images[count]);\n        count++;\n        if (count == imageURLs.length) doneAction(imageURLs.length === 1 ? images[0] : images);\n    }\n\n    return {\n        done() {\n            doneAction = arguments[0] || doneAction;\n        },\n        progress() {\n            progressAction = arguments[0] || progressAction;\n        },\n    };\n}\n\nexport function getSize(node) {\n    if (!node.tagName) return console.log('Invalid element.');\n\n    const name = node.tagName;\n    const type = name === 'IMG' ? 'image' : (name === 'CANVAS' ? 'canvas' : 'normal');\n\n    const result = {\n        image: {\n            width: node.naturalWidth,\n            height: node.naturalHeight,\n        },\n        canvas: {\n            width: node.width,\n            height: node.height,\n        },\n        normal: {\n            width: node.offsetWidth,\n            height: node.offsetHeight,\n        },\n    };\n\n    return result[type];\n}\n","import { getSize, preload } from 'common';\n\nexport default function sketch() {\n    if (!(this instanceof sketch)) return new sketch(...arguments);\n    this.init(...arguments);\n}\n\nsketch.prototype.init = function () {\n    const [width, height] = arguments;\n\n    this.canvas = document.createElement('canvas');\n    this.context = this.canvas.getContext('2d');\n    this.width = width;\n    this.height = height;\n    this.sprites = [];\n    this.actions = [];\n};\n\nsketch.prototype.import = function (imageURL) {\n    this.actions.push(() => {\n        preload(imageURL).done(image => {\n            const { width, height } = getSize(image);\n            this.canvas.width = width;\n            this.canvas.height = height;\n            this.context.drawImage(image, 0, 0);\n            this.next();\n        });\n    });\n    return this;\n};\n\nsketch.prototype.push = function (options = {}) {\n    this.actions.push(() => {\n        preload(options.image).done(image => {\n            const { width, height } = getSize(image);\n            this.context.drawImage(image, 0, 0, width, height);\n            this.next();\n        });\n    });\n    return this;\n};\n\nsketch.prototype.next = function () {\n    this.actions.length === 0 ? this.done() : this.actions.shift()();\n};\n\nsketch.prototype.export = function (output) {\n    this.done = function () {\n        const base = this.canvas.toDataURL('image/jpeg');\n        output(base);\n    };\n    this.next(this.context);\n};\n"],"names":["const","let","this"],"mappings":"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"}