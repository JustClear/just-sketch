{"version":3,"file":"sketch.js","sources":["../src/common.js","../src/index.js"],"sourcesContent":["export function preload(imageURLs, done) {\n    const images = [];\n    let count = 0;\n    imageURLs = (typeof imageURLs != 'object') ? [imageURLs] : imageURLs;\n\n    imageURLs.length === 0 && done(images);\n\n    imageURLs.map(imageURL => {\n        const image = new Image();\n        image.src = imageURL;\n        image.crossOrigin = '*';\n        image.addEventListener('load', imageOnLoad);\n        image.addEventListener('error', imageOnLoad);\n        images.push(image);\n    });\n\n    function imageOnLoad() {\n        count ++;\n        if (count == imageURLs.length) done(images);\n    }\n}\n","import { preload } from './common';\n\nexport default function sketch() {\n    if (!(this instanceof sketch)) return new sketch(...arguments);\n    this.init(...arguments);\n}\n\nsketch.prototype.init = function () {\n    const [width, height] = arguments;\n\n    if (typeof width === 'number' && typeof height === 'number') {\n        this.width = width;\n        this.height = height;\n    }\n\n    this.symbols = [];\n    this.catch = function() {};\n};\n\nsketch.prototype.initCanvas = function (width, height) {\n    this.canvas = document.createElement('canvas');\n    this.canvas.width = width;\n    this.canvas.height = height;\n    this.ctx = this.canvas.getContext('2d');\n    return this.ctx;\n};\n\nsketch.prototype.import = function (image) {\n    if (typeof image === 'string') {\n        this.background = image;\n    } else {\n        console.log('.import(): import unknown type.');\n    }\n    return this;\n};\n\nsketch.prototype.join = function (image = '', options = {}) {\n    if (typeof image === 'string') {\n        options.image = image;\n        this.symbols.push(options);\n    } else {\n        console.log('.join(): join unknown type.');\n    }\n    return this;\n};\n\nsketch.prototype.export = function (output = function () {}) {\n    preload(this.background, ([background]) => {\n        this.width = this.width || background.naturalWidth;\n        this.height = this.height || background.naturalHeight;\n        const context = this.initCanvas(this.width, this.height);\n        context.drawImage(background, 0, 0, this.width, this.height);\n\n        preload(this.symbols.map(symbol => symbol.image), (images) => {\n            images.map((image, index) => {\n                const option = this.symbols[index];\n                const { top, right, bottom, left } = option;\n                let width, height, offsetX, offsetY;\n                option.ratio = image.naturalHeight / image.naturalWidth;\n                if (option.width && option.height == undefined) {\n                    width = option.width;\n                    height = width * option.ratio;\n                } else if (option.height && option.width == undefined) {\n                    height = option.height;\n                    width = height / option.ratio;\n                } else if (option.width && option.height) {\n                    width = option.width;\n                    height = option.height;\n                } else if (option.height == undefined && option.width == undefined) {\n                    width = image.naturalWidth;\n                    height = image.naturalHeight;\n                } else {\n                    console.log('joined symbol size error');\n                }\n                if (left && top) {\n                    offsetX = left;\n                    offsetY = top;\n                } else if (left && bottom) {\n                    offsetX = left;\n                    offsetY = this.height - (height + bottom);\n                } else if (right && top) {\n                    offsetX = this.width - (width + right);\n                    offsetY = top;\n                } else if (right && bottom) {\n                    offsetX = this.width - (width + right);\n                    offsetY = this.height - (height + bottom);\n                } else {\n                    console.log('symbol position error: only adjacent sides position are accepted');\n                }\n                offsetX = offsetX || 0;\n                offsetY = offsetY || 0;\n                context.drawImage(image, 0, 0, image.naturalWidth, image.naturalHeight, offsetX , offsetY , width, height);\n            });\n            try {\n                output(this.canvas.toDataURL(sketch.imageType || 'image/jpeg'), context, this.canvas);\n            } catch (error) {\n                setTimeout(() => this.catch(error), 0);\n            }\n        });\n    });\n    return this;\n};\n"],"names":["preload","imageURLs","done","images","count","length","map","image","Image","src","imageURL","crossOrigin","addEventListener","imageOnLoad","push","sketch","arguments","init","prototype","width","height","symbols","catch","initCanvas","canvas","document","createElement","ctx","getContext","import","background","log","join","options","export","output","naturalWidth","naturalHeight","context","drawImage","symbol","index","option","top","right","bottom","left","offsetX","offsetY","ratio","undefined","toDataURL","imageType","error"],"mappings":"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"}