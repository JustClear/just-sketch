{"version":3,"file":"sketch.min.js","sources":["../src/common.js","../src/index.js"],"sourcesContent":["export function preload(imageURLs, done) {\n    const images = [];\n    let count = 0;\n    imageURLs = (typeof imageURLs != 'object') ? [imageURLs] : imageURLs;\n\n    imageURLs.length === 0 && done(images);\n\n    imageURLs.map(imageURL => {\n        const image = new Image();\n        image.src = imageURL;\n        image.crossOrigin = '*';\n        image.addEventListener('load', imageOnLoad);\n        image.addEventListener('error', imageOnLoad);\n        images.push(image);\n    });\n\n    function imageOnLoad() {\n        count ++;\n        if (count == imageURLs.length) done(images);\n    }\n}\n","import { preload } from './common';\n\nexport default function sketch() {\n    if (!(this instanceof sketch)) return new sketch(...arguments);\n    this.init(...arguments);\n}\n\nsketch.prototype.init = function () {\n    const [width, height] = arguments;\n\n    if (typeof width === 'number' && typeof height === 'number') {\n        this.width = width;\n        this.height = height;\n    }\n\n    this.symbols = [];\n    this.catch = function() {};\n};\n\nsketch.prototype.initCanvas = function (width, height) {\n    this.canvas = document.createElement('canvas');\n    this.canvas.width = width;\n    this.canvas.height = height;\n    this.ctx = this.canvas.getContext('2d');\n    return this.ctx;\n};\n\nsketch.prototype.import = function (image) {\n    if (typeof image === 'string') {\n        this.background = image;\n    } else {\n        console.log('.import(): import unknown type.');\n    }\n    return this;\n};\n\nsketch.prototype.join = function (image = '', options = {}) {\n    if (typeof image === 'string') {\n        options.image = image;\n        this.symbols.push(options);\n    } else {\n        console.log('.join(): join unknown type.');\n    }\n    return this;\n};\n\nsketch.prototype.export = function (output = function () {}) {\n    preload(this.background, ([background]) => {\n        this.width = this.width || background.naturalWidth;\n        this.height = this.height || background.naturalHeight;\n        const context = this.initCanvas(this.width, this.height);\n        context.drawImage(background, 0, 0, this.width, this.height);\n\n        preload(this.symbols.map(symbol => symbol.image), (images) => {\n            images.map((image, index) => {\n                const option = this.symbols[index];\n                const { top, right, bottom, left } = option;\n                let width, height, offsetX, offsetY;\n                option.ratio = image.naturalHeight / image.naturalWidth;\n                if (option.width && option.height == undefined) {\n                    width = option.width;\n                    height = width * option.ratio;\n                } else if (option.height && option.width == undefined) {\n                    height = option.height;\n                    width = height / option.ratio;\n                } else if (option.width && option.height) {\n                    width = option.width;\n                    height = option.height;\n                } else if (option.height == undefined && option.width == undefined) {\n                    width = image.naturalWidth;\n                    height = image.naturalHeight;\n                } else {\n                    console.log('joined symbol size error');\n                }\n                if (left && top) {\n                    offsetX = left;\n                    offsetY = top;\n                } else if (left && bottom) {\n                    offsetX = left;\n                    offsetY = this.height - (height + bottom);\n                } else if (right && top) {\n                    offsetX = this.width - (width + right);\n                    offsetY = top;\n                } else if (right && bottom) {\n                    offsetX = this.width - (width + right);\n                    offsetY = this.height - (height + bottom);\n                } else {\n                    console.log('symbol position error: only adjacent sides position are accepted');\n                }\n                offsetX = offsetX || 0;\n                offsetY = offsetY || 0;\n                context.drawImage(image, 0, 0, image.naturalWidth, image.naturalHeight, offsetX , offsetY , width, height);\n            });\n            try {\n                output(this.canvas.toDataURL(sketch.imageType || 'image/jpeg'), context, this.canvas);\n            } catch (error) {\n                setTimeout(() => this.catch(error), 0);\n            }\n        });\n    });\n    return this;\n};\n"],"names":["preload","imageURLs","done","imageOnLoad","length","images","count","map","image","Image","src","imageURL","crossOrigin","addEventListener","push","sketch","this","arguments","init","prototype","width","height","symbols","catch","initCanvas","canvas","document","createElement","ctx","getContext","import","background","log","join","options","export","output","_this","naturalWidth","naturalHeight","context","drawImage","symbol","index","option","top","right","bottom","left","offsetX","offsetY","ratio","undefined","toDataURL","imageType","error"],"mappings":"2LAAA,SAAgBA,EAAQC,EAAWC,YAgBtBC,SAEQF,EAAUG,QAAQF,EAAKG,OAjBlCA,KACFC,EAAQ,EAGS,OAFY,oBAAbL,gBAAAA,KAA0BA,GAAaA,GAEjDG,QAAgBF,EAAKG,KAErBE,IAAI,gBACJC,EAAQ,IAAIC,QACZC,IAAMC,IACNC,YAAc,MACdC,iBAAiB,OAAQV,KACzBU,iBAAiB,QAASV,KACzBW,KAAKN,KCbpB,SAEwBO,SACdC,gBAAgBD,GAAS,yCAAWA,2CAAUE,mBAC/CC,gBAAQD,woBAGjBF,EAAOI,UAAUD,KAAO,4CACID,WAAjBG,OAAOC,OAEO,iBAAVD,GAAwC,iBAAXC,SAC/BD,MAAQA,OACRC,OAASA,QAGbC,gBACAC,MAAQ,cAGjBR,EAAOI,UAAUK,WAAa,SAAUJ,EAAOC,eACtCI,OAASC,SAASC,cAAc,eAChCF,OAAOL,MAAQA,OACfK,OAAOJ,OAASA,OAChBO,IAAMZ,KAAKS,OAAOI,WAAW,MAC3Bb,KAAKY,KAGhBb,EAAOI,UAAUW,OAAS,SAAUtB,SACX,iBAAVA,OACFuB,WAAavB,UAEVwB,IAAI,mCAEThB,MAGXD,EAAOI,UAAUc,KAAO,eAAUzB,yDAAQ,GAAI0B,kEACrB,iBAAV1B,KACCA,MAAQA,OACXc,QAAQR,KAAKoB,YAEVF,IAAI,+BAEThB,MAGXD,EAAOI,UAAUgB,OAAS,sBAAUC,yDAAS,sBACjCpB,KAAKe,WAAY,gBAAEA,cAClBX,MAAQiB,EAAKjB,OAASW,EAAWO,eACjCjB,OAASgB,EAAKhB,QAAUU,EAAWQ,kBAClCC,EAAUH,EAAKb,WAAWa,EAAKjB,MAAOiB,EAAKhB,UACzCoB,UAAUV,EAAY,EAAG,EAAGM,EAAKjB,MAAOiB,EAAKhB,UAE7CgB,EAAKf,QAAQf,IAAI,mBAAUmC,EAAOlC,QAAQ,SAACH,KACxCE,IAAI,SAACC,EAAOmC,OACTC,EAASP,EAAKf,QAAQqB,GACpBE,EAA6BD,EAA7BC,IAAKC,EAAwBF,EAAxBE,MAAOC,EAAiBH,EAAjBG,OAAQC,EAASJ,EAATI,KACxB5B,SAAOC,SAAQ4B,SAASC,WACrBC,MAAQ3C,EAAM+B,cAAgB/B,EAAM8B,aACvCM,EAAOxB,YAA0BgC,GAAjBR,EAAOvB,YACfuB,EAAOxB,OACEwB,EAAOO,MACjBP,EAAOvB,aAA0B+B,GAAhBR,EAAOxB,WACtBwB,EAAOvB,QACCuB,EAAOO,MACjBP,EAAOxB,OAASwB,EAAOvB,UACtBuB,EAAOxB,QACNwB,EAAOvB,aACQ+B,GAAjBR,EAAOvB,aAAuC+B,GAAhBR,EAAOxB,SACpCZ,EAAM8B,eACL9B,EAAM+B,uBAEPP,IAAI,4BAEZgB,GAAQH,KACEG,IACAH,GACHG,GAAQD,KACLC,IACAX,EAAKhB,QAAUA,EAAS0B,IAC3BD,GAASD,KACNR,EAAKjB,OAASA,EAAQ0B,KACtBD,GACHC,GAASC,KACNV,EAAKjB,OAASA,EAAQ0B,KACtBT,EAAKhB,QAAUA,EAAS0B,YAE1Bf,IAAI,sEAENiB,GAAW,IACXC,GAAW,IACbT,UAAUjC,EAAO,EAAG,EAAGA,EAAM8B,aAAc9B,EAAM+B,cAAeU,EAAUC,EAAU9B,EAAOC,WAG5FgB,EAAKZ,OAAO4B,UAAUtC,EAAOuC,WAAa,cAAed,EAASH,EAAKZ,QAChF,MAAO8B,cACM,kBAAMlB,EAAKd,MAAMgC,IAAQ,QAIzCvC"}