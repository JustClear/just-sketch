{"version":3,"file":"sketch.min.js","sources":["../src/common.js","../src/index.js"],"sourcesContent":["export function preload(imageURLs, done) {\n    const images = [];\n    let count = 0;\n    imageURLs = (typeof imageURLs != 'object') ? [imageURLs] : imageURLs;\n\n    imageURLs.length === 0 && done(images);\n\n    imageURLs.map(imageURL => {\n        const image = new Image();\n        image.src = imageURL;\n        image.crossOrigin = '*';\n        image.addEventListener('load', imageOnLoad);\n        image.addEventListener('error', imageOnLoad);\n        images.push(image);\n    });\n\n    function imageOnLoad() {\n        count ++;\n        if (count == imageURLs.length) done(images);\n    }\n}\n","import { preload } from './common';\n\nexport default function sketch() {\n    if (!(this instanceof sketch)) return new sketch(...arguments);\n    this.init(...arguments);\n}\n\nsketch.prototype.init = function () {\n    const [width, height] = arguments;\n\n    if (typeof width === 'number' && typeof height === 'number') {\n        this.width = width;\n        this.height = height;\n    }\n\n    this.symbols = [];\n    this.catch = function() {};\n};\n\nsketch.prototype.initCanvas = function (width, height) {\n    this.canvas = document.createElement('canvas');\n    this.canvas.width = width;\n    this.canvas.height = height;\n    this.ctx = this.canvas.getContext('2d');\n    return this.ctx;\n};\n\nsketch.prototype.import = function (image) {\n    if (typeof image === 'string') {\n        this.background = image;\n    } else {\n        console.log('.import(): import unknown type.');\n    }\n    return this;\n};\n\nsketch.prototype.join = function (image = '', options = {}) {\n    if (typeof image === 'string') {\n        options.image = image;\n        this.symbols.push(options);\n    } else {\n        console.log('.join(): join unknown type.');\n    }\n    return this;\n};\n\nsketch.prototype.rect = function (options = {}) {\n    options.type = 'rect';\n    this.symbols.push(options);\n    return this;\n};\n\nsketch.prototype.export = function (output = function () {}) {\n    preload(this.background, ([background]) => {\n        this.naturalRatio = background.naturalHeight / background.naturalWidth;\n        this.width = this.width || background.naturalWidth;\n        this.height = this.height || background.naturalHeight;\n        this.initCanvas(this.width, this.height);\n        this.ctx.drawImage(background, 0, 0, this.width, this.width * this.naturalRatio);\n\n        preload(this.symbols.map(symbol => symbol.image || ''), (images) => {\n            images.map((image, index) => {\n                const option = this.symbols[index];\n                const { top = 0, right = 0, bottom = 0, left = 0 } = option;\n                let width, height, offsetX, offsetY;\n                option.ratio = image.naturalHeight / image.naturalWidth;\n                if (option.width && option.height == undefined) {\n                    width = option.width;\n                    height = width * option.ratio;\n                } else if (option.height && option.width == undefined) {\n                    height = option.height;\n                    width = height / option.ratio;\n                } else if (option.width && option.height) {\n                    width = option.width;\n                    height = option.height;\n                } else if (option.height == undefined && option.width == undefined) {\n                    width = image.naturalWidth;\n                    height = image.naturalHeight;\n                } else {\n                    console.log('joined symbol size error');\n                }\n                if (left !== 0 && top !== 0) {\n                    offsetX = left;\n                    offsetY = top;\n                } else if (left !== 0 && bottom !== 0) {\n                    offsetX = left;\n                    offsetY = this.height - (height + bottom);\n                } else if (right !== 0 && top !== 0) {\n                    offsetX = this.width - (width + right);\n                    offsetY = top;\n                } else if (right !== 0 && bottom !== 0) {\n                    offsetX = this.width - (width + right);\n                    offsetY = this.height - (height + bottom);\n                } else {\n                    console.log('symbol position error: only adjacent sides position are accepted');\n                }\n                width = width || 0;\n                height = height || 0;\n                offsetX = offsetX || 0;\n                offsetY = offsetY || 0;\n                if (option.type == 'rect') {\n                    if (option.backgroundColor) {\n                        this.ctx.fillStyle = option.backgroundColor || '#000';\n                        this.ctx.fillRect(offsetX + option.borderWidth, offsetY + option.borderWidth, width, height);\n                    }\n                    if (option.borderWidth) {\n                        this.ctx.beginPath();\n                        this.ctx.lineWidth = option.borderWidth;\n                        this.ctx.strokeStyle = option.borderColor || '#000';\n                        this.ctx.rect(offsetX + option.borderWidth, offsetY + option.borderWidth, width, height);\n                        this.ctx.stroke();\n                    }\n                } else {\n                    this.ctx.drawImage(image, 0, 0, image.naturalWidth, image.naturalHeight, offsetX , offsetY , width, height);\n                }\n            });\n            try {\n                output(this.canvas.toDataURL(`image/${sketch.imageType || 'jpeg'}`), this.ctx, this.canvas);\n            } catch (error) {\n                setTimeout(() => this.catch(error), 0);\n            }\n        });\n    });\n    return this;\n};\n"],"names":["preload","imageURLs","done","imageOnLoad","count","length","images","map","imageURL","const","image","Image","src","crossOrigin","addEventListener","push","sketch","init","ref","arguments","argsArray","prototype","width","height","symbols","catch","initCanvas","canvas","document","createElement","ctx","getContext","import","background","console","log","join","options","rect","type","export","output","this","naturalRatio","naturalHeight","naturalWidth","drawImage","symbol","index","option","let","offsetX","offsetY","ratio","left","top","bottom","right","backgroundColor","fillStyle","fillRect","borderWidth","beginPath","lineWidth","strokeStyle","borderColor","stroke","toDataURL","imageType","error","setTimeout"],"mappings":"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"}